<!DOCTYPE html>

<html>
<head><title></title></head>
<body>
    <script src="~/Static/js/library/jquery/jquery-1.10.2.js"></script>
    
    <!--Reference the SignalR library. -->
    <script src="~/Static/js/library/jquery.signalR/jquery.signalR-2.0.0.js"></script>
    
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="http://geonowapp.azurewebsites.net/signalr/hubs"></script>
    
    <!--Add script to do stuff--> 
    <script type="text/javascript">

        var geolocator = {
            executeCallback: function (position) {
                this.callback(position);
            },
            callback: null,
            watchPosition: function (callback) {
                this.callback = callback;
            }
        };
        

        var execute = function (userID, position) {
            $.connection.hub.url = "http://geonowapp.azurewebsites.net/signalr";

            $.connection.hub.qs = {
                "userID": userID,
                "geoLocation": position
            };

            var stream = $.connection.streamHub;

            stream.client.pollServer = function (postID) {
                window.external.notify(postID);
            };


            $.connection.hub.start().done(function () {
                geolocator.watchPosition(function (position) {
                    stream.server.updateLocation(position);
                });

            });
        };


        var updateLocation = function (position) {
            geolocator.executeCallback(position);
        };

    </script>
</body>
</html>
